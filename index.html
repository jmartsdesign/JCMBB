<!doctype html>
<html lang="en">
<!-- Codigo inicial gerado automaticamente by AFRAME Exporter for Blender - https://silverslade.itch.io/a-frame-blender-exporter
    MIT License: https://github.com/silverslade/aframe_blender_exporter/blob/master/LICENSE 
    Modificado e adptado por Jorge Antunes-->

<head>
    <title>Jardim CMBB</title>
    <link rel="icon" type="image/png" href="favicon.ico" />
    <meta name="description" content="3D Application" />
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@v7.4.0/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component/dist/aframe-event-set-component.min.js"></script>
    <script
        src="https://unpkg.com/aframe-aabb-collider-component@3.1.0/dist/aframe-aabb-collider-component.min.js"></script>
    <script
        src="https://unpkg.com/aframe-fps-counter-component@1.0.1/dist/aframe-fps-counter-component.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://unpkg.com/aframe-proxy-event-component/dist/aframe-proxy-event-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-blink-controls/dist/aframe-blink-controls.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component/dist/aframe-environment-component.min.js"></script>
    <script src="https://unpkg.com/aframe-proxemic-component@0.0.21/dist/aframe-proxemic-component.min.js"></script>

    <link rel="stylesheet" type="text/css" href="style.css" />

    <!-- Botões do palco  -->
    <style>
        .button-container {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .nav-button {
            padding: 10px 20px;
            margin: 0 10px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .nav-button:hover {
            background-color: #45a049;
        }

        #legend-container {
            margin: 0 20px;
            width: 200px;
            height: 140px;
            /* Ajuste conforme necessário */
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #legend-image {
            max-width: 100%;
            max-height: 100%;
        }

        /* CSS para crregar imagem no centro */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }

        #loading-screen img {
            width: 480px;
            height: 270px;
        }
    </style>

</head>

<body>
    <!-- Exibe imagem de carregamento -->
    <div id="loading-screen">
        <img src="./assets/loading.gif" alt="Carregando...">
    </div>

    <!-- Menu de botões manual web
    <div class="button-container">
        <button class="nav-button">Anterior</button>
        <div id="legend-container">
            <img id="legend-image" src="./assets/PaineisInfo/Painel00Legenda.png" alt="Legenda da cena">
        </div>
        <button class="nav-button">Próxima</button>
    </div>  --->

    <a-scene webcentric renderer="physicallyCorrectLights: false" cursor="rayOrigin:mouse"
        raycaster="objects: .clickable">
        <!-- Disable inspector  
            <script>
                var sceneEl = document.querySelector("a-scene");
                sceneEl.addEventListener("loaded", function () {
                    sceneEl.removeAttribute("inspector");
                });
            </script>  -->

        <!-- Assets ------------------------------------------------->
        <a-assets>
            <!--Elementos 3D -->
            <a-asset-item id="JCMBB3D" src="./assets/JCMBB3D.glb"></a-asset-item>
            <a-asset-item id="PalcoEmblema" src="./assets/CenaNE--Anima-V3-C10-Final-3.glb"></a-asset-item>
            <a-asset-item id="EntradaCMBB" src="./assets/e-Entrada360.glb"></a-asset-item>
            <a-asset-item id="BaseMovimento" src="./assets/Base-Movimento.glb"></a-asset-item>
            <a-asset-item id="Heart" src="./assets/Heart.glb"></a-asset-item>
            <a-asset-item id="seta" src="./assets/seta.glb"></a-asset-item>

            <img id="PortaoEntrada" src="./assets/portao.png" />

            <!--imagem cenários 360 
            <img id="EntradaCMBB360" crossorigin="anonymous" src="./assets/Entrada_CMBB360-01.jpg" /> ----->
            <img id="SkyJardimCMBB" crossorigin="anonymous" src="./assets/sky.jpg" />

            <!--imagems dos paineis informativo -->
            <img id="infopanel" crossorign="anonymous" src="./assets/PainelNFO.png" />
            <img id="iPainelLegenda00" crossorign="anonymous" src="./assets/PaineisInfo/Painel00Legenda.png" />
            <img id="iPainelLegenda01" crossorign="anonymous" src="./assets/PaineisInfo/Painel01Legenda.png" />
            <img id="iPainelLegenda02" crossorign="anonymous" src="./assets/PaineisInfo/Painel02Legenda.png" />
            <img id="iPainelLegenda03" crossorign="anonymous" src="./assets/PaineisInfo/Painel03Legenda.png" />
            <img id="iPainelLegenda04" crossorign="anonymous" src="./assets/PaineisInfo/Painel04Legenda.png" />
            <img id="iPainelLegenda05" crossorign="anonymous" src="./assets/PaineisInfo/Painel05Legenda.png" />
            <img id="iPainelLegenda06" crossorign="anonymous" src="./assets/PaineisInfo/Painel06Legenda.png" />
            <img id="iPainelLegenda07" crossorign="anonymous" src="./assets/PaineisInfo/Painel07Legenda.png" />
            <img id="iPainelLegenda08" crossorign="anonymous" src="./assets/PaineisInfo/Painel08Legenda.png" />
            <img id="iPainelLegenda09" crossorign="anonymous" src="./assets/PaineisInfo/Painel09Legenda.png" />
            <img id="iPainelLegenda10" crossorign="anonymous" src="./assets/PaineisInfo/Painel10Legenda.png" />

            <!--imagems dos paineis Emblemas -->
            <img id="PainelCordis-1" crossorign="anonymous" src="./assets/PaineisInfo/P1.png" />
            <img id="PainelCordis-2" crossorign="anonymous" src="./assets/PaineisInfo/P2.png" />
            <img id="PainelCordis-3" crossorign="anonymous" src="./assets/PaineisInfo/P3.png" />
            <img id="PainelCordis-4" crossorign="anonymous" src="./assets/PaineisInfo/P4.png" />
            <img id="PainelCordis-5" crossorign="anonymous" src="./assets/PaineisInfo/P5.png" />
            <img id="PainelCordis-6" crossorign="anonymous" src="./assets/PaineisInfo/P6.png" />
            <img id="PainelCordis-7" crossorign="anonymous" src="./assets/PaineisInfo/P7.png" />
            <img id="PainelCordis-8" crossorign="anonymous" src="./assets/PaineisInfo/P8.png" />
            <img id="PainelCordis-9" crossorign="anonymous" src="./assets/PaineisInfo/P9.png" />
            <img id="PainelCordis-10" crossorign="anonymous" src="./assets/PaineisInfo/P10.png" />

            <!-- Audio -->
            <audio id="SoundAmbi" src="./assets/NarrativaAudio/contemplation-227152.mp3"></audio>
            <audio id="SoundP0" src="./assets/NarrativaAudio/Silencio.mp3"></audio>
            <audio id="SoundP1" src="./assets/NarrativaAudio/P1-2024-7-15-17-39-51.mp3"></audio>
            <audio id="SoundP2" src="./assets/NarrativaAudio/P2-2024-7-18-16-28-22.mp3"></audio>
            <audio id="SoundP3" src="./assets/NarrativaAudio/P3-2024-7-18-16-29-37.mp3"></audio>
            <audio id="SoundP4" src="./assets/NarrativaAudio/P4-2024-7-18-16-32-39.mp3"></audio>
            <audio id="SoundP5" src="./assets/NarrativaAudio/P5-2024-7-18-16-34-12.mp3"></audio>
            <audio id="SoundP6" src="./assets/NarrativaAudio/P6-2024-7-18-16-39-22.mp3"></audio>
            <audio id="SoundP7" src="./assets/NarrativaAudio/P7-2024-7-18-15-49-23.mp3"></audio>
            <audio id="SoundP8" src="./assets/NarrativaAudio/P8-2024-7-18-15-51-19.mp3"></audio>
            <audio id="SoundP9" src="./assets/NarrativaAudio/P9-2024-7-18-15-53-57.mp3"></audio>
            <audio id="SoundP10" src="./assets/NarrativaAudio/P10-2024-7-18-15-56-26.mp3"></audio>
        </a-assets>

        <!-- Entities ----------------------------------------------->

        <!--Entrada CMBB  - https://aframe-course.glitch.me/0600-portals.html -->
        <a-link position="-14.25 -0.6 -29.65" rotation="0 -90 0" scale="0.5 0.5" href="https://www.fbb.pt/cmbb/"
            title="CMBB">
        </a-link>

        <!-- Camera e PLAYER -------------------------------------------------------------------------------------->
        <a-entity id="player" position="-15 0 15" rotation="0 -40 0"
            movement-controls="speed: 0.1; constrainToNavMesh: true"
            sound="src: #SoundAmbi; volume: 0.65; autoplay: true; loop: true" panel-visibility-controller>
            <a-entity id="camera" camera="near: 0.001" position="0 1.7 0" look-controls="pointerLockEnabled: false">
                <a-sphere id="cabeca" radius="0.1"></a-sphere>
            </a-entity>
            <a-entity oculus-touch-controls="hand: right" blink-controls="collisionEntities:#BaseMovimento-0"> 
                <a-sphere id="RightControlSphere" color="blue" geometry="radius: 0.05" visible="false"
                    position="-0.00499 -0.02196 -0.05457"></a-sphere>
                    <a-entity gltf-model="#seta" scale="0.2 0.2 0.2" position="-0.00499 -0.02196 -0.05457"></a-entity>
                <!--<a-entity fps-counter position="0 0.2 0" rotation="-30 0 0"> </a-entity>-->
            </a-entity>
            <a-entity oculus-touch-controls="hand: left" id="LeftControl">
                <!-- Mini palco -->
                <a-entity id="PalcoEmblemaPortable" rotation="-38 0 0" gltf-model="#PalcoEmblema"
                    scale="0.015 0.015 0.015" shadow="cast: false" position="0.01347 0.07 -0.04938"
                    animation-mixer="clip: Cena0"></a-entity>
                <!-- Botões de navegação -->
                <a-entity id="nav-buttons" position="0.00732 0.14714 0.07596"
                    rotation="-61.35060182922316 -18.013793078913082 18.661235387410912">
                    <a-entity id="prev-button" class="nav-button" aabb-collider="objects: #RightControlSphere; "
                        event-set__hitstart="material.opacity:0.5" event-set__hitend="material.opacity:1"
<<<<<<< HEAD
                        geometry="primitive: box; width: 0.02; height: 0.02; depth: 0.01" material="color: #4CAF50"
                        gltf-model="#Heart"
=======
                        gltf-model="#Heart" material="color: #4CAF50" 
>>>>>>> 413653da64ca49f06b244df8d6c4d2cdfc20bcb7
                        position="-0.020 0 0" scale="0.015 0.015 0.015" text="value: <; align: center; width: 0.1"
                        onclick="document.querySelector('[scene-controller]').components['scene-controller'].changeScene('prev')"></a-entity>
                   <!-- <a-entity id="next-button" class="nav-button" aabb-collider="objects: #RightControlSphere; "
                        event-set__hitstart="material.opacity:0.5" event-set__hitend="material.opacity:1"
                        geometry="primitive: box; width: 0.02; height: 0.02; depth: 0.01" material="color: #4CAF50"
                        position="0.025 0 0" text="value: >; align: center; width: 0.1"
                        onclick="document.querySelector('[scene-controller]').components['scene-controller'].changeScene('next')"></a-entity> -->
                </a-entity>
                <!-- Legenda 3D Controlador -->
                <a-entity id="LegendaImage3D" look-at="[camera]" position="0.01347 0.1 -0.04938" rotation="-35 0 0"
                    scale="1.2 1.2 1.2">
                    <a-plane id="legend-plane" src="#iPainelLegenda00" width="0.2" height="0.1" transparent="true"
                        side="double"></a-plane>
                </a-entity>
            </a-entity>
        </a-entity>

        <!-- Base de movimento Limites -->
        <a-entity id="BaseMovimento-0" gltf-model="#BaseMovimento" scale="1 1 1" visible="false" nav-mesh></a-entity>

        <!-- Sky e Entrada do Jardim -------------------->
        <a-entity id="SkyPrincipal" position="0 0 0">
            <a-sky src="#SkyJardimCMBB" geometry="radius: 100"></a-sky>
        </a-entity>

        <!-- Entrada exterior no Jardim da CMBB 360 ------------>
        <a-sphere cloak="#EntradaCMBBe360" radius="6" position="-14.5 2 13" geometry="phiLength: 330"
            rotation="-11.161217849148436 -127.17027446046673 41.43573478606601">
        </a-sphere>
        <a-entity id="EntradaCMBBe360" gltf-model="#EntradaCMBB" scale="1 1 1" visible="true"></a-entity>
        <a-entity id="door1" position="-11.893 1.778 9.354" rotation="0 -45 0" scale="1.383 1.819 1.019"
            proximity-sensor="distance: 3"
            animation__open="property: rotation; to: 0 45 0; dur: 1000; startEvents: proximityenter"
            animation__close="property: rotation; to: 0 -45 0; dur: 1000; startEvents: proximityexit">
            <a-plane src="#PortaoEntrada" width="1" height="2" depth="0.1" position="0.633 0 -0.062" transparent="true"
                side:"double"></a-plane>
        </a-entity>

        <!-- Painel de entrada exterior -->
        <a-entity class="infopanel-1" position="-16.5 1.5 12.5" look-at="[camera]" billboard="" mouse-wheel-zoom=""
            visible="" rotation="0 0 0" scale="2.3 2.5 2.3">
            <a-image src="#infopanel" position="0.43 0.01822 -0.09828" height="2" width="1.3" material=""
                geometry="height: 1.8" visible=""></a-image>
            <a-text class="title"
                font="https://raw.githubusercontent.com/jorgecardoso/aframe-course-resources/master/fonts/montserrat-bold.fnt"
                position="0.53807 0.41799 -0.02767" width="1" value="Escola do Coração" align="left" color="#00000f"
                anchor="center" baseline="top" height="0.02" wrap-count="20" text="" visible=""></a-text>
            <a-text class="description" baseline="top" width="0.9"
                font="https://raw.githubusercontent.com/jorgecardoso/aframe-course-resources/master/fonts/montserrat.fnt"
                position="-0.00619 0.30181 -0.01332"
                value="Entra numa viagem emblemática experiência imersiva de Realidade Virtual no Jardim da Casa Museu Bissaya Barreto em Coimbra, Portugal. 
                O jardim, construído nas primeiras décadas do século XX, apresenta uma série de painéis de azulejos barrocos que adaptam motivos logo-icónicos do livro de emblemas Schola Cordis, de Benedictus van Haeften.

                Aaplicação explora o conceito de emblemática aplicada através da criação de uma experiência imersiva de realidade virtual e realidade aumentada (RV/RA)"
                align="left" color="black" text="">
            </a-text>
        </a-entity>

        <!-- JArdim CMBB 3D -->
        <a-entity id="JardimCMBB" gltf-model="#JCMBB3D" scale="1 1 1" visible="true" shadow="cast: false"></a-entity>

        <!-- Palco e Emblema 3D ---------------------------------------------------->
        <a-entity id="PalcoEmblema_1">
            <a-box width="6" height="6" depth="6" position="-6.586 1.2 -15.314" color="red"
                aabb-collider="objects: #cabeca; debug: false" visible="false"
                event-set__enter="_event: hitstart; _target: #player; _emit: hitstart"
                event-set__exit="_event: hitend; _target: #player; _emit: hitend"></a-box>
            <a-entity id="PalcoEmblema3D" rotation="0 0 0" gltf-model="#PalcoEmblema" scale="0.2 0.2 0.2"
                shadow="cast: false" position="-6.586 1.2 -15.314"
                animation="property: rotation; to: 0 360 0; dur: 9500; loop: true" animation-mixer="clip: Cena0">
            </a-entity>
        </a-entity>

        <!-- Adiciona o elementos áudio à cena -->
        <a-entity id="AudiosPaineis" position="-6.586 1.2 -15.314">
            <a-entity id="sound0"
                sound="src: #SoundP0; volume: 1; refDistance: 45; rolloffFactor: 0.5; autoplay: false"></a-entity>
            <a-entity id="sound1"
                sound="src: #SoundP1; volume: 1; refDistance: 45; rolloffFactor: 0.5; autoplay: false"></a-entity>
            <a-entity id="sound2"
                sound="src: #SoundP2; volume: 1; refDistance: 45; rolloffFactor: 0.5; autoplay: false"></a-entity>
            <a-entity id="sound3"
                sound="src: #SoundP3; volume: 1; refDistance: 45; rolloffFactor: 0.5; autoplay: false"></a-entity>
            <a-entity id="sound4"
                sound="src: #SoundP4; volume: 1; refDistance: 45; rolloffFactor: 0.5; autoplay: false"></a-entity>
            <a-entity id="sound5"
                sound="src: #SoundP5; volume: 1; refDistance: 45; rolloffFactor: 0.5; autoplay: false"></a-entity>
            <a-entity id="sound6"
                sound="src: #SoundP6; volume: 1; refDistance: 45; rolloffFactor: 0.5; autoplay: false"></a-entity>
            <a-entity id="sound7"
                sound="src: #SoundP7; volume: 1; refDistance: 45; rolloffFactor: 0.5; autoplay: false"></a-entity>
            <a-entity id="sound8"
                sound="src: #SoundP8; volume: 1; refDistance: 45; rolloffFactor: 0.5; autoplay: false"></a-entity>
            <a-entity id="sound9"
                sound="src: #SoundP9; volume: 1; refDistance: 45; rolloffFactor: 0.5; autoplay: false"></a-entity>
            <a-entity id="sound10"
                sound="src: #SoundP10; volume: 1; refDistance: 45; rolloffFactor: 0.5; autoplay: false"></a-entity>
        </a-entity>

        <!-- JardimCMBB PAINEIS -------------------------------->

        <!-- Painel 01 -->
        <a-entity id="SceneController">
            <a-box width="2" height="2" depth="1.5" position="-12 1.4 1.75" color="red"
                aabb-collider="objects: #cabeca; " visible="false"
                event-set__coliliderstart="_event: hitstart; _target:#CordisPanel-1; visible:true"
                event-set__coliliderend="_event: hitend; _target:#CordisPanel-1; visible:false"
                event-set__coliliderstartLegenda="_event: hitstart; _target:#PainelLegenda01; visible:true"
                event-set__coliliderendLegenda="_event: hitend; _target:#PainelLegenda01; visible:false"
                proxy-event="event: hitstart; to: #PalcoEmblema3D; as: hitPainel1"
                proxy-event__exit="event: hitend; to: #PalcoEmblema3D; as: exitPainel"
                proxy-event__portablestart="event: hitstart; to: #PalcoEmblemaPortable; as: hitPainel1"
                proxy-event__portableexit="event: hitend; to: #PalcoEmblemaPortable; as: exitPainel"
                proxy-event__player="event: hitstart; to: #player; as: hitPainelPortable1"
                proxy-event__playerexit="event: hitend; to: #player; as: exitPainelPortable1">
            </a-box>
            <!-- Mostra o Painel Azulejo -->
            <a-entity id="CordisPanel-1" class="infopanel" position="-13.6 1.4 1.75" visible="false" rotation="0 90 0">
                <a-image src="#PainelCordis-1" height="2" width="2"></a-image>
            </a-entity>
            <a-entity id="PainelLegenda01" class="infopanel" position="-13 0.5 1.75" look-at="[camera]" visible="false"
                rotation="0 90 0">
                <a-image src="#iPainelLegenda01" height="0.7" width="1"></a-image>
            </a-entity>
        </a-entity>
        <!-- Painel 02 -->
        <a-entity id="SceneController">
            <a-box width="2" height="2" depth="1.5" position="-12 1.4 -0.35" color="red"
                aabb-collider="objects: #cabeca; " visible="false"
                event-set__coliliderstart="_event: hitstart; _target:#CordisPanel-2; visible:true"
                event-set__coliliderend="_event: hitend; _target:#CordisPanel-2; visible:false"
                event-set__coliliderstartLegenda="_event: hitstart; _target:#PainelLegenda02; visible:true"
                event-set__coliliderendLegenda="_event: hitend; _target:#PainelLegenda02; visible:false"
                proxy-event="event: hitstart; to: #PalcoEmblema3D; as: hitPainel2"
                proxy-event__exit="event: hitend; to: #PalcoEmblema3D; as: exitPaine2"
                proxy-event__portablestart="event: hitstart; to: #PalcoEmblemaPortable; as: hitPainel2"
                proxy-event__portableexit="event: hitend; to: #PalcoEmblemaPortable; as: exitPainel"
                proxy-event__player="event: hitstart; to: #player; as: hitPainelPortable2"
                proxy-event__playerexit="event: hitend; to: #player; as: exitPainelPortable2">
            </a-box>
            <!-- Mostra o Painel Azulejo -->
            <a-entity id="CordisPanel-2" class="infopanel" position="-13.6 1.4 -0.35" visible="false" rotation="0 90 0">
                <a-image src="#PainelCordis-2" height="2" width="2"></a-image>
            </a-entity>
            <a-entity id="PainelLegenda02" class="infopanel" position="-13 0.5 -0.35" look-at="[camera]" visible="false"
                rotation="0 90 0">
                <a-image src="#iPainelLegenda02" height="0.7" width="1"></a-image>
            </a-entity>
        </a-entity>
        <!-- Painel 03 -->
        <a-entity id="SceneController">
            <a-box width="2" height="2" depth="1.5" position="-12 1.4 -2.4" color="red"
                aabb-collider="objects: #cabeca; " visible="false"
                event-set__coliliderstart="_event: hitstart; _target:#CordisPanel-3; visible:true"
                event-set__coliliderend="_event: hitend; _target:#CordisPanel-3; visible:false"
                event-set__coliliderstartLegenda="_event: hitstart; _target:#PainelLegenda03; visible:true"
                event-set__coliliderendLegenda="_event: hitend; _target:#PainelLegenda03; visible:false"
                proxy-event="event: hitstart; to: #PalcoEmblema3D; as: hitPainel3"
                proxy-event__exit="event: hitend; to: #PalcoEmblema3D; as: exitPainel"
                proxy-event__portablestart="event: hitstart; to: #PalcoEmblemaPortable; as: hitPainel3"
                proxy-event__portableexit="event: hitend; to: #PalcoEmblemaPortable; as: exitPainel"
                proxy-event__player="event: hitstart; to: #player; as: hitPainelPortable3"
                proxy-event__playerexit="event: hitend; to: #player; as: exitPainelPortable3">
            </a-box>
            <a-entity id="CordisPanel-3" class="infopanel" position="-13.6 1.4 -2.4" visible="false" rotation="0 90 0">
                <a-image src="#PainelCordis-3" height="2" width="2"></a-image>
            </a-entity>
            <a-entity id="PainelLegenda03" class="infopanel" position="-13 0.5 -2.4" look-at="[camera]" visible="false"
                rotation="0 90 0">
                <a-image src="#iPainelLegenda03" height="0.7" width="1"></a-image>
            </a-entity>
        </a-entity>
        <!-- Painel 04 -->
        <a-entity id="SceneController">
            <a-box width="2" height="2" depth="1.5" position="-12 1.4 -4.4" color="red"
                aabb-collider="objects: #cabeca; " visible="false"
                event-set__coliliderstart="_event: hitstart; _target:#CordisPanel-4; visible:true"
                event-set__coliliderend="_event: hitend; _target:#CordisPanel-4; visible:false"
                event-set__coliliderstartLegenda="_event: hitstart; _target:#PainelLegenda04; visible:true"
                event-set__coliliderendLegenda="_event: hitend; _target:#PainelLegenda04; visible:false"
                proxy-event="event: hitstart; to: #PalcoEmblema3D; as: hitPainel4"
                proxy-event__exit="event: hitend; to: #PalcoEmblema3D; as: exitPaine4"
                proxy-event__portablestart="event: hitstart; to: #PalcoEmblemaPortable; as: hitPainel4"
                proxy-event__portableexit="event: hitend; to: #PalcoEmblemaPortable; as: exitPainel"
                proxy-event__player="event: hitstart; to: #player; as: hitPainelPortable4"
                proxy-event__playerexit="event: hitend; to: #player; as: exitPainelPortable4">
            </a-box>
            <a-entity id="CordisPanel-4" class="infopanel" position="-13.6 1.4 -4.4" visible="false" rotation="0 90 0">
                <a-image src="#PainelCordis-4" height="2" width="2"></a-image>
            </a-entity>
            <a-entity id="PainelLegenda04" class="infopanel" position="-13 0.5 -4.4" look-at="[camera]" visible="false"
                rotation="0 90 0">
                <a-image src="#iPainelLegenda04" height="0.7" width="1"></a-image>
            </a-entity>
        </a-entity>
        <!-- Painel 05 -->
        <a-entity id="SceneController">
            <a-box width="2" height="2" depth="1.5" position="-12 1.4 -6.4" color="red"
                aabb-collider="objects: #cabeca; " visible="false"
                event-set__coliliderstart="_event: hitstart; _target:#CordisPanel-5; visible:true"
                event-set__coliliderend="_event: hitend; _target:#CordisPanel-5; visible:false"
                event-set__coliliderstartLegenda="_event: hitstart; _target:#PainelLegenda05; visible:true"
                event-set__coliliderendLegenda="_event: hitend; _target:#PainelLegenda05; visible:false"
                proxy-event="event: hitstart; to: #PalcoEmblema3D; as: hitPainel5"
                proxy-event__exit="event: hitend; to: #PalcoEmblema3D; as: exitPaine5"
                proxy-event__portablestart="event: hitstart; to: #PalcoEmblemaPortable; as: hitPainel5"
                proxy-event__portableexit="event: hitend; to: #PalcoEmblemaPortable; as: exitPainel"
                proxy-event__player="event: hitstart; to: #player; as: hitPainelPortable5"
                proxy-event__playerexit="event: hitend; to: #player; as: exitPainelPortable5">
            </a-box>
            <a-entity id="CordisPanel-5" class="infopanel" position="-13.6 1.4 -6.4" visible="false" rotation="0 90 0">
                <a-image src="#PainelCordis-5" height="2" width="2"></a-image>
            </a-entity>
            <a-entity id="PainelLegenda05" class="infopanel" position="-13 0.5 -6.4" look-at="[camera]" visible="false"
                rotation="0 90 0">
                <a-image src="#iPainelLegenda05" height="0.7" width="1"></a-image>
            </a-entity>
        </a-entity>
        <!-- Painel 06 -->
        <a-entity id="SceneController">
            <a-box width="2" height="2" depth="1.5" position="-12 1.4 -11.7" color="red"
                aabb-collider="objects: #cabeca; " visible="false"
                event-set__coliliderstart="_event: hitstart; _target:#CordisPanel-6; visible:true"
                event-set__coliliderend="_event: hitend; _target:#CordisPanel-6; visible:false"
                event-set__coliliderstartLegenda="_event: hitstart; _target:#PainelLegenda06; visible:true"
                event-set__coliliderendLegenda="_event: hitend; _target:#PainelLegenda06; visible:false"
                proxy-event="event: hitstart; to: #PalcoEmblema3D; as: hitPainel6"
                proxy-event__exit="event: hitend; to: #PalcoEmblema3D; as: exitPaine6"
                proxy-event__portablestart="event: hitstart; to: #PalcoEmblemaPortable; as: hitPainel6"
                proxy-event__portableexit="event: hitend; to: #PalcoEmblemaPortable; as: exitPainel"
                proxy-event__player="event: hitstart; to: #player; as: hitPainelPortable6"
                proxy-event__playerexit="event: hitend; to: #player; as: exitPainelPortable6">
            </a-box>
            <a-entity id="CordisPanel-6" class="infopanel" position="-13.6 1.4 -11.7" visible="false" rotation="0 90 0">
                <a-image src="#PainelCordis-6" height="2" width="2"></a-image>
            </a-entity>
            <a-entity id="PainelLegenda06" class="infopanel" position="-13 0.5 -11.7" look-at="[camera]" visible="false"
                rotation="0 90 0">
                <a-image src="#iPainelLegenda06" height="0.7" width="1"></a-image>
            </a-entity>
        </a-entity>
        <!-- Painel 07 -->
        <a-entity id="SceneController">
            <a-box width="2" height="2" depth="1.5" position="-12 1.4 -13.7" color="red"
                aabb-collider="objects: #cabeca; " visible="false"
                event-set__coliliderstart="_event: hitstart; _target:#CordisPanel-7; visible:true"
                event-set__coliliderend="_event: hitend; _target:#CordisPanel-7; visible:false"
                event-set__coliliderstartLegenda="_event: hitstart; _target:#PainelLegenda07; visible:true"
                event-set__coliliderendLegenda="_event: hitend; _target:#PainelLegenda07; visible:false"
                proxy-event="event: hitstart; to: #PalcoEmblema3D; as: hitPainel7"
                proxy-event__exit="event: hitend; to: #PalcoEmblema3D; as: exitPaine7"
                proxy-event__portablestart="event: hitstart; to: #PalcoEmblemaPortable; as: hitPainel7"
                proxy-event__portableexit="event: hitend; to: #PalcoEmblemaPortable; as: exitPainel"
                proxy-event__player="event: hitstart; to: #player; as: hitPainelPortable7"
                proxy-event__playerexit="event: hitend; to: #player; as: exitPainelPortable7">
            </a-box>
            <a-entity id="CordisPanel-7" class="infopanel" position="-13.6 1.4 -13.7" visible="false" rotation="0 90 0">
                <a-image src="#PainelCordis-7" height="2" width="2"></a-image>
            </a-entity>
            <a-entity id="PainelLegenda07" class="infopanel" position="-13 0.5 -13.7" look-at="[camera]" visible="false"
                rotation="0 90 0">
                <a-image src="#iPainelLegenda07" height="0.7" width="1"></a-image>
            </a-entity>
        </a-entity>
        <!-- Painel 08 -->
        <a-entity id="SceneController">
            <a-box width="2" height="2" depth="1.5" position="-12 1.4 -15.7" color="red"
                aabb-collider="objects: #cabeca; " visible="false"
                event-set__coliliderstart="_event: hitstart; _target:#CordisPanel-8; visible:true"
                event-set__coliliderend="_event: hitend; _target:#CordisPanel-8; visible:false"
                event-set__coliliderstartLegenda="_event: hitstart; _target:#PainelLegenda08; visible:true"
                event-set__coliliderendLegenda="_event: hitend; _target:#PainelLegenda08; visible:false"
                proxy-event="event: hitstart; to: #PalcoEmblema3D; as: hitPainel8"
                proxy-event__exit="event: hitend; to: #PalcoEmblema3D; as: exitPaine8"
                proxy-event__portablestart="event: hitstart; to: #PalcoEmblemaPortable; as: hitPainel8"
                proxy-event__portableexit="event: hitend; to: #PalcoEmblemaPortable; as: exitPainel"
                proxy-event__player="event: hitstart; to: #player; as: hitPainelPortable8"
                proxy-event__playerexit="event: hitend; to: #player; as: exitPainelPortable8">
            </a-box>
            <a-entity id="CordisPanel-8" class="infopanel" position="-13.6 1.4 -15.7" visible="false" rotation="0 90 0">
                <a-image src="#PainelCordis-8" height="2" width="2"></a-image>
            </a-entity>
            <a-entity id="PainelLegenda08" class="infopanel" position="-13 0.5 -15.7" look-at="[camera]" visible="false"
                rotation="0 90 0">
                <a-image src="#iPainelLegenda08" height="0.7" width="1"></a-image>
            </a-entity>
        </a-entity>
        <!-- Painel 09 -->
        <a-entity id="SceneController">
            <a-box width="2" height="2" depth="1.5" position="-12 1.4 -17.7" color="red"
                aabb-collider="objects: #cabeca; " visible="false"
                event-set__coliliderstart="_event: hitstart; _target:#CordisPanel-9; visible:true"
                event-set__coliliderend="_event: hitend; _target:#CordisPanel-9; visible:false"
                event-set__coliliderstartLegenda="_event: hitstart; _target:#PainelLegenda09; visible:true"
                event-set__coliliderendLegenda="_event: hitend; _target:#PainelLegenda09; visible:false"
                proxy-event="event: hitstart; to: #PalcoEmblema3D; as: hitPainel9"
                proxy-event__exit="event: hitend; to: #PalcoEmblema3D; as: exitPaine9"
                proxy-event__portablestart="event: hitstart; to: #PalcoEmblemaPortable; as: hitPainel9"
                proxy-event__portableexit="event: hitend; to: #PalcoEmblemaPortable; as: exitPainel"
                proxy-event__player="event: hitstart; to: #player; as: hitPainelPortable9"
                proxy-event__playerexit="event: hitend; to: #player; as: exitPainelPortable9">
            </a-box>
            <a-entity id="CordisPanel-9" class="infopanel" position="-13.6 1.4 -17.7" visible="false" rotation="0 90 0">
                <a-image src="#PainelCordis-9" height="2" width="2"></a-image>
            </a-entity>
            <a-entity id="PainelLegenda09" class="infopanel" position="-13 0.5 -17.7" look-at="[camera]" visible="false"
                rotation="0 90 0">
                <a-image src="#iPainelLegenda09" height="0.7" width="1"></a-image>
            </a-entity>
        </a-entity>
        <!-- Painel 10 -->
        <a-entity id="SceneController">
            <a-box width="2" height="2" depth="1.5" position="-12 1.4 -19.7" color="red"
                aabb-collider="objects: #cabeca; " visible="false"
                event-set__coliliderstart="_event: hitstart; _target:#CordisPanel-10; visible:true"
                event-set__coliliderend="_event: hitend; _target:#CordisPanel-10; visible:false"
                event-set__coliliderstartLegenda="_event: hitstart; _target:#PainelLegenda10; visible:true"
                event-set__coliliderendLegenda="_event: hitend; _target:#PainelLegenda10; visible:false"
                proxy-event="event: hitstart; to: #PalcoEmblema3D; as: hitPainel10"
                proxy-event__exit="event: hitend; to: #PalcoEmblema3D; as: exitPaine10"
                proxy-event__portablestart="event: hitstart; to: #PalcoEmblemaPortable; as: hitPainel10"
                proxy-event__portableexit="event: hitend; to: #PalcoEmblemaPortable; as: exitPainel"
                proxy-event__player="event: hitstart; to: #player; as: hitPainelPortable10"
                proxy-event__playerexit="event: hitend; to: #player; as: exitPainelPortable10">
            </a-box>
            <a-entity id="CordisPanel-10" class="infopanel" position="-13.6 1.4 -19.5" visible="false"
                rotation="0 90 0">
                <a-image src="#PainelCordis-10" height="2" width="2"></a-image>
            </a-entity>
            <a-entity id="PainelLegenda10" class="infopanel" position="-13 0.5 -19.5" look-at="[camera]" visible="false"
                rotation="0 90 0">
                <a-image src="#iPainelLegenda10" height="0.7" width="1"></a-image>
            </a-entity>
        </a-entity>
    </a-scene>

    <!-- JavaScipts --------------------------------------------------------------------------------------------------->

    <!-- Função Contrala animação dos emblemas Retornando á Cen0 e atribui o audio e legendas--->
    <script>
        AFRAME.registerComponent('scene-controller', {
            init: function () {
                var el = this.el;
                var currentSound = null;
                var currentSceneIndex = 0;

                // Função para atualizar a legenda
                function updateLegend(sceneNumber) {
                    const legendNumber = sceneNumber.toString().padStart(2, '0');
                    const legendImageSrc = `./assets/PaineisInfo/Painel${legendNumber}Legenda.png`;

                    // Atualiza a imagem de legenda 2D
                    const legendImage = document.getElementById('legend-image');
                    if (legendImage) {
                        legendImage.src = legendImageSrc;
                        legendImage.alt = `Legenda da cena ${sceneNumber}`;
                    }

                    // Atualiza a imagem de legenda 3D (se aplicável)
                    const legendaImage3D = document.getElementById('LegendaImage3D');
                    if (legendaImage3D) {
                        legendaImage3D.setAttribute('src', legendImageSrc);
                    }

                    // Atualiza a imagem de legenda 3D
                    const legendPlane = document.getElementById('legend-plane');
                    if (legendPlane) {
                        legendPlane.setAttribute('src', legendImageSrc);
                    }

                    console.log(`Atualizando legenda para cena ${sceneNumber}: ${legendImageSrc}`);
                }

                // Função para tocar o som
                function playSound(sceneNumber) {
                    if (currentSound) {
                        currentSound.components.sound.stopSound();
                    }
                    currentSound = document.querySelector('#sound' + sceneNumber);
                    if (currentSound && currentSound.components.sound) {
                        console.log('Playing sound for scene:', sceneNumber);
                        currentSound.components.sound.playSound();
                    } else {
                        console.warn('Sound component not found for scene:', sceneNumber);
                    }
                }

                // Configurar listeners para cada painel
                for (var i = 1; i <= 10; i++) {
                    (function (sceneNumber) {
                        el.addEventListener('hitPainel' + sceneNumber, function () {
                            console.log('Entering scene:', sceneNumber);
                            el.setAttribute('animation-mixer', 'clip: Cena' + sceneNumber + '; startAt: 100;');
                            playSound(sceneNumber);
                            updateLegend(sceneNumber);
                            currentSceneIndex = sceneNumber;
                        });
                    })(i);
                }

                // Listener genérico para sair de qualquer painel
                el.addEventListener('exitPainel', function () {
                    console.log('Exiting to scene 0');
                    el.setAttribute('animation-mixer', 'clip: Cena0; startAt: 0;');
                    playSound(0);
                    updateLegend(0);
                    currentSceneIndex = 0;
                });

                // Adicionar funções para navegação manual (botões)
                this.changeScene = function (direction) {
                    if (direction === 'next') {
                        currentSceneIndex = (currentSceneIndex + 1) % 11; // 11 porque temos cenas de 0 a 10
                    } else if (direction === 'prev') {
                        currentSceneIndex = (currentSceneIndex - 1 + 11) % 11;
                    }
                    el.setAttribute('animation-mixer', `clip: Cena${currentSceneIndex}; startAt: 100;`);
                    playSound(currentSceneIndex);
                    updateLegend(currentSceneIndex);
                };

                // Adicionar event listeners para os botões de navegação
                const prevButton = document.querySelector('.nav-button:first-child');
                const nextButton = document.querySelector('.nav-button:last-child');
                if (prevButton && nextButton) {
                    prevButton.addEventListener('click', () => this.changeScene('prev'));
                    nextButton.addEventListener('click', () => this.changeScene('next'));
                }


                // para intersecçao com o controlador
                if (prevButton && nextButton) {
                    prevButton.addEventListener('hitstart', () => this.changeScene('prev'));
                    nextButton.addEventListener('histart', () => this.changeScene('next'));
                }
            }
        });

        // Adicionar o componente aos elementos
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelector('#PalcoEmblema3D').setAttribute('scene-controller', '');
            document.querySelector('#PalcoEmblemaPortable').setAttribute('scene-controller', '');
        });
    </script>

    <!-- Função Contrala Palco Visibilidade Controlador--->
    <script>
        AFRAME.registerComponent('panel-visibility-controller', {
            init: function () {
                this.palcoEmblemaPortable = document.querySelector('#PalcoEmblemaPortable');
                this.legendaImage3D = document.querySelector('#LegendaImage3D');
                this.isNearPanel = false;
                this.isNearPalcoEmblema = false;
                this.currentPanelNumber = 0;

                // Inicialmente, esconda o PalcoEmblemaPortable e a legenda
                this.palcoEmblemaPortable.setAttribute('visible', false);
                this.legendaImage3D.setAttribute('visible', false);

                // Eventos para os painéis
                for (let i = 1; i <= 10; i++) {
                    this.el.addEventListener(`hitPainelPortable${i}`, () => this.enterPanel(i));
                    this.el.addEventListener(`exitPainelPortable${i}`, this.exitPanel.bind(this));
                }

                // Eventos para o PalcoEmblema_1
                const palcoEmblema1 = document.querySelector('#PalcoEmblema_1');
                palcoEmblema1.addEventListener('hitstart', this.enterPalcoEmblema.bind(this));
                palcoEmblema1.addEventListener('hitend', this.exitPalcoEmblema.bind(this));
            },

            enterPanel: function (panelNumber) {
                this.isNearPanel = true;
                this.currentPanelNumber = panelNumber;
                this.updateVisibility();
            },

            exitPanel: function () {
                this.isNearPanel = false;
                this.currentPanelNumber = 0;
                this.updateVisibility();
            },

            enterPalcoEmblema: function () {
                this.isNearPalcoEmblema = true;
                this.updateVisibility();
            },

            exitPalcoEmblema: function () {
                this.isNearPalcoEmblema = false;
                this.updateVisibility();
            },

            updateVisibility: function () {
                // Mostrar palco quando perto de um painel, esconder a legenda
                if (this.isNearPanel) {
                    this.palcoEmblemaPortable.setAttribute('visible', true);
                    this.legendaImage3D.setAttribute('visible', false);
                }
                // Mostrar legenda quando perto do PalcoEmblema_1, esconder o palco
                else if (this.isNearPalcoEmblema) {
                    this.palcoEmblemaPortable.setAttribute('visible', false);
                    this.legendaImage3D.setAttribute('visible', true);
                    // Usar a legenda correspondente ao último painel visitado
                    const legendaSrc = this.currentPanelNumber > 0 ?
                        `#iPainelLegenda${this.currentPanelNumber.toString().padStart(2, '0')}` :
                        '#iPainelLegenda00';
                    this.legendaImage3D.querySelector('#legend-plane').setAttribute('src', legendaSrc);
                }
                // Esconder ambos quando não estiver perto de nenhum
                else {
                    this.palcoEmblemaPortable.setAttribute('visible', false);
                    this.legendaImage3D.setAttribute('visible', false);
                }
            }
        });
    </script>

    <!-- Função torna invisivel a esfera 360 exteriormente da entrada ---------------------------------------------->
    <script>
        AFRAME.registerComponent("cloak", {
            schema: { type: "selectorAll" },
            setRenderOrder: function (el, order) {
                let mesh = el.getObject3D("mesh");
                let _this = this;
                if (!mesh) {
                    el.addEventListener("model-loaded", function () {
                        _this.setRenderOrder(el, order);
                    });
                    return;
                }
                console.log("setting render order on ", el, "to ", order);
                mesh.renderOrder = order;
            },
            init: function () {
                console.log("Setting cloak");
                let cloak = this.el;

                console.log("Cloak loaded");
                let mesh = cloak.getObject3D("mesh"); // grab the mesh
                if (mesh === undefined) {
                    console.log("no mesh");
                    return;
                } // return if no mesh :(
                mesh.traverse(function (node) {
                    // traverse through and apply settings
                    if (node.isMesh && node.material) {
                        // make sure the element can be a cloak
                        console.log(node);
                        node.material.colorWrite = false;
                        node.material.needsUpdate = true;
                    }
                });
                mesh.renderOrder = 1;
                console.log(cloak.children);
                for (const child of this.data) {
                    this.setRenderOrder(child, 11);
                }
            }
        });
    </script>

    <!-- Função para esconder o loaded quando estiver a pagina estiver pronta para exebir -->
    <script>
        document.querySelector('a-scene').addEventListener('loaded', function () {
            document.getElementById('loading-screen').style.display = 'none';
        });
    </script>

</body>

</html>

<!-- Mestrado de Design e Multimédia -->