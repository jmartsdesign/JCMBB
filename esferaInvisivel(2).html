<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Esfera com Objetos GLB Invisíveis de Fora</title>
        <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    </head>
    <body>
        <a-scene>
            <a-assets>
                <img id="esfera-textura" src="/assets/Entrada_CMBB360-01.jpg" />
                <img id="sky-textura" src="/assets/sky.jpg" />
                <a-asset-item id="modelo1" src="/assets/Base-Movimento-e360.glb"></a-asset-item>
                <a-asset-item id="modelo2" src="/assets/CenaNE--Anima-V1-2-2.glb"></a-asset-item>
            </a-assets>

            <!-- Skybox -->
            <a-sky src="#sky-textura"></a-sky>

            <a-entity id="conteudo-esfera" visibility-control>
                <a-sphere
                    id="esfera"
                    radius="5"
                    material="src: #esfera-textura; transparent: true; opacity: 0.9; side: back"
                    position="0 1.6 0">
                </a-sphere>
                <a-entity gltf-model="#modelo1" position="1 1 1" scale="0.5 0.5 0.5"></a-entity>
                <a-entity gltf-model="#modelo2" position="-1 1-1" scale="0.5 0.5 0.5"></a-entity>
            </a-entity>

            <a-camera position="0 1.6 10"></a-camera>
        </a-scene>

        <script>
            AFRAME.registerComponent("visibility-control", {
                init: function () {
                    this.camera = document.querySelector("a-camera").object3D;
                    this.sphere = this.el.querySelector("#esfera").object3D;
                    this.sphereRadius = 10;
                    this.cameraPos = new THREE.Vector3();
                    this.spherePos = new THREE.Vector3();

                    // Inicialmente, torne todos os objetos invisíveis
                    this.el.object3D.traverse((obj) => {
                        if (obj.type === "Mesh") {
                            obj.visible = false;
                        }
                    });
                },
                tick: function () {
                    this.camera.getWorldPosition(this.cameraPos);
                    this.sphere.getWorldPosition(this.spherePos);

                    var distance = this.cameraPos.distanceTo(this.spherePos);

                    this.el.object3D.traverse((obj) => {
                        if (obj.type === "Mesh") {
                            obj.visible = distance <= this.sphereRadius;
                        }
                    });
                }
            });
        </script>
    </body>
    <!--  https://www.perplexity.ai/search/explica-este-codigo-a-sphere-c-IxOH6xhnQk2JNtTuHMj1PQ#18  -->
</html>
