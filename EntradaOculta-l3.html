<<<<<<< Updated upstream
<!doctype html>
sd<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Objeto GLB com Visibilidade Controlada</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
</head>
<body>
    <a-scene>
        <a-assets>
            <img id="sky-textura" src="/assets/sky.jpg">
             <a-asset-item id="JCMBB3D" src="./assets/JCMBB3D.glb"></a-asset-item>
            <a-asset-item id="modelo-principalglb" src="/assets/e-Entrada360.glb"></a-asset-item>
            <a-asset-item id="modelo1" src="/assets/CenaNE--Anima-V1-2-2.glb"></a-asset-item>
        </a-assets>

        <!-- Skybox -->
        <a-sky src="#sky-textura"></a-sky>
        
                    <!-- JArdim CMBB 3D -->
            <a-entity
                id="JardimCMBB"
                gltf-model="#JCMBB3D"
                scale="1 1 1"
                visible="true"
                shadow="cast: false"></a-entity>

        <a-entity id="conteudo-principal" visibility-control="radiusMultiplier: 1.6">
            <a-entity id="modelo-principal" 
                      gltf-model="#modelo-principalglb"
                      position="0 0 0"
                      scale="1 1 1">
            </a-entity>
            <a-entity gltf-model="#modelo1" position="-14.44532 0 13.16565" scale="0.5 0.5 0.5"></a-entity>

        </a-entity>

        <a-camera position="-14.44532 1.6 13.16565"></a-camera>
    </a-scene>

    <script>
    AFRAME.registerComponent('visibility-control', {
        schema: {
            radiusMultiplier: {type: 'number', default: 1}
        },
        init: function () {
            this.camera = document.querySelector('a-camera').object3D;
            this.mainModel = this.el.querySelector('#modelo-principal').object3D;
            this.cameraPos = new THREE.Vector3();
            this.modelCenter = new THREE.Vector3();
            this.boundingRadius = 0;

            // Inicialmente, torne todos os objetos invisíveis
            this.el.object3D.traverse((obj) => {
                if (obj.type === 'Mesh') {
                    obj.visible = false;
                }
            });

            // Aguarde o carregamento do modelo
            this.el.querySelector('#modelo-principal').addEventListener('model-loaded', () => {
                this.calculateBoundingRadius();
                this.updateVisibility();
            });
        },
        calculateBoundingRadius: function () {
            let boundingBox = new THREE.Box3().setFromObject(this.mainModel);
            let size = boundingBox.getSize(new THREE.Vector3());
            this.boundingRadius = Math.max(size.x, size.y, size.z) / 2 * this.data.radiusMultiplier;
            boundingBox.getCenter(this.modelCenter);
        },
        tick: function () {
            this.updateVisibility();
        },
        updateVisibility: function () {
            if (this.boundingRadius === 0) return; // Aguarde o cálculo do raio

            this.camera.getWorldPosition(this.cameraPos);
            this.mainModel.localToWorld(this.modelCenter.clone());

            var distance = this.cameraPos.distanceTo(this.modelCenter);

            this.el.object3D.traverse((obj) => {
                if (obj.type === 'Mesh') {
                    obj.visible = distance <= this.boundingRadius;
                }
            });
        }
    });
    </script>
</body>
</html>

<!-- https://www.perplexity.ai/search/explica-este-codigo-a-sphere-c-IxOH6xhnQk2JNtTuHMj1PQ#22   -->
=======
<!doctype html> sd
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Objeto GLB com Visibilidade Controlada</title>
        <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@v7.4.0/dist/aframe-extras.min.js"></script>
        <script src="https://unpkg.com/aframe-event-set-component/dist/aframe-event-set-component.min.js"></script>
        <script src="https://unpkg.com/aframe-aabb-collider-component@3.1.0/dist/aframe-aabb-collider-component.min.js"></script>
        <script src="https://unpkg.com/aframe-fps-counter-component@1.0.1/dist/aframe-fps-counter-component.min.js"></script>
        <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
        <script src="https://unpkg.com/aframe-proxy-event-component/dist/aframe-proxy-event-component.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/aframe-blink-controls/dist/aframe-blink-controls.min.js"></script>
    </head>
    <body>
        <a-scene>
            <a-assets>
                <img id="sky-textura" src="/assets/sky.jpg" />
                <a-asset-item id="JCMBB3D" src="./assets/JCMBB3D.glb"></a-asset-item>
                <a-asset-item id="modelo-principalglb" src="/assets/e-Entrada360.glb"></a-asset-item>
                <a-asset-item id="BaseMovimento" src="./assets/Base-Movimento-e360.glb"></a-asset-item>
                <a-asset-item id="modelo1" src="/assets/CenaNE--Anima-V1-2-2.glb"></a-asset-item>
            </a-assets>

            <!-- Skybox -->
            <a-sky src="#sky-textura"></a-sky>

            <!-- Base de movimento Limites -->
            <a-entity id="BaseMovimento-0" gltf-model="#BaseMovimento" scale="1 1 1" visible="true" nav-mesh></a-entity>

            <!-- JArdim CMBB 3D -->
            <a-entity
                id="JardimCMBB"
                gltf-model="#JCMBB3D"
                scale="1 1 1"
                visible="true"
                shadow="cast: false"></a-entity>

            <a-entity id="conteudo-principal" visibility-control="radiusMultiplier: 1.6">
                <a-entity id="modelo-principal" gltf-model="#modelo-principalglb" position="0 0 0" scale="1 1 1">
                </a-entity>
                <a-entity gltf-model="#modelo1" position="-14.44532 0 13.16565" scale="0.5 0.5 0.5"></a-entity>
            </a-entity>

            <!--  -->
            <a-camera position="-14.44532 1.6 13.16565"></a-camera>

            <!-- Camera e PLAYER --------------------------------------------
            <a-entity id="camerarig" position="0 0 0">
                <a-entity id="player" movement-controls="speed: 0.1; constrainToNavMesh: true">
                    <a-entity
                        id="camera"
                        camera="near: 0.001"
                        position="0 1.7 0"
                        look-controls="pointerLockEnabled: false">
                        <a-sphere id="cabeca" radius="0.1"></a-sphere>
                    </a-entity>
                    <a-entity oculus-touch-controls="hand: right" blink-controls="collisionEntities:#BaseMovimento-0">
                        <a-entity fps-counter position="0 0.2 0" rotation="-30 0 0"> </a-entity>
                    </a-entity>
                    <a-entity oculus-touch-controls="hand: left" id="LeftControl">
                    </a-entity>
                </a-entity>
            </a-entity>    -->
        </a-scene>

        <script>
            AFRAME.registerComponent("visibility-control", {
                schema: {
                    radiusMultiplier: { type: "number", default: 1 }
                },
                init: function () {
                    this.camera = document.querySelector("a-camera").object3D;
                    this.mainModel = this.el.querySelector("#modelo-principal").object3D;
                    this.cameraPos = new THREE.Vector3();
                    this.modelCenter = new THREE.Vector3();
                    this.boundingRadius = 0;

                    // Inicialmente, torne todos os objetos invisíveis
                    this.el.object3D.traverse((obj) => {
                        if (obj.type === "Mesh") {
                            obj.visible = false;
                        }
                    });

                    // Aguarde o carregamento do modelo
                    this.el.querySelector("#modelo-principal").addEventListener("model-loaded", () => {
                        this.calculateBoundingRadius();
                        this.updateVisibility();
                    });
                },
                calculateBoundingRadius: function () {
                    let boundingBox = new THREE.Box3().setFromObject(this.mainModel);
                    let size = boundingBox.getSize(new THREE.Vector3());
                    this.boundingRadius = (Math.max(size.x, size.y, size.z) / 2) * this.data.radiusMultiplier;
                    boundingBox.getCenter(this.modelCenter);
                },
                tick: function () {
                    this.updateVisibility();
                },
                updateVisibility: function () {
                    if (this.boundingRadius === 0) return; // Aguarde o cálculo do raio

                    this.camera.getWorldPosition(this.cameraPos);
                    this.mainModel.localToWorld(this.modelCenter.clone());

                    var distance = this.cameraPos.distanceTo(this.modelCenter);

                    this.el.object3D.traverse((obj) => {
                        if (obj.type === "Mesh") {
                            obj.visible = distance <= this.boundingRadius;
                        }
                    });
                }
            });
        </script>
    </body>
</html>

<!-- https://www.perplexity.ai/search/explica-este-codigo-a-sphere-c-IxOH6xhnQk2JNtTuHMj1PQ#22   -->
>>>>>>> Stashed changes
